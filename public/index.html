<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2TP中转管理面板</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- 登录界面 -->
    <div id="loginSection" class="login-container">
        <div class="login-box">
            <h2><i class="fas fa-shield-alt"></i> L2TP中转管理面板</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">登录</button>
                <div id="loginError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- 主控制台界面 -->
    <div id="dashboardSection" class="dashboard-container" style="display: none;">
        <!-- 顶部导航 -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1><i class="fas fa-server"></i> L2TP中转管理面板</h1>
            </div>
            <div class="header-right">
                <button id="logoutBtn" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> 退出登录
                </button>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="dashboard-main">
            <!-- 系统状态卡片 -->
            <div class="status-cards">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> 系统状态</h3>
                    </div>
                    <div class="card-body" id="systemStatusContainer">
                        <p>加载中...</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-exchange-alt"></i> 流量统计</h3>
                    </div>
                    <div class="card-body" id="trafficStatsContainer">
                        <p>加载中...</p>
                    </div>
                </div>
            </div>

            <!-- 服务器管理 -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-server"></i> L2TP服务器管理</h3>
                    <div class="header-actions">
                        <button id="exportServersBtn" class="btn btn-info">
                            <i class="fas fa-download"></i> 导出配置
                        </button>
                        <button id="addServerBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> 新建服务器
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>地址</th>
                                    <th>中转端口</th>
                                    <th>状态</th>
                                    <th>到期时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="serversTableBody">
                                <tr>
                                    <td colspan="7" class="text-center">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 服务器编辑模态框 -->
    <div id="serverModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="serverModalTitle">新建服务器</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="serverForm">
                    <input type="hidden" id="serverId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="serverName">服务器名称 *</label>
                            <input type="text" id="serverName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="serverHost">服务器地址 *</label>
                            <input type="text" id="serverHost" name="host" placeholder="IP地址或域名" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="serverPort">SSH端口</label>
                            <input type="number" id="serverPort" name="port" value="22" min="1" max="65535">
                        </div>
                        <div class="form-group">
                            <label for="serverL2TPPort">中转端口 *</label>
                            <input type="number" id="serverL2TPPort" name="l2tp_port" placeholder="1701" min="1" max="65535" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="serverUsername">SSH用户名 *</label>
                            <input type="text" id="serverUsername" name="username" required>
                        </div>
                        <div class="form-group">
                            <label for="serverPassword">SSH密码 *</label>
                            <input type="password" id="serverPassword" name="password" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="serverPSK">预共享密钥(PSK)</label>
                            <input type="text" id="serverPSK" name="psk">
                        </div>
                        <div class="form-group">
                            <label for="serverExpireDate">到期时间</label>
                            <input type="date" id="serverExpireDate" name="expire_date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="serverUsers">用户配置</label>
                        <div id="usersContainer">
                            <div class="user-config-item">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>用户名</label>
                                        <input type="text" class="user-username" placeholder="输入用户名" required>
                                    </div>
                                    <div class="form-group">
                                        <label>密码</label>
                                        <input type="password" class="user-password" placeholder="输入密码" required>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-danger btn-sm remove-user-btn" onclick="l2tpManager.removeUser(this)">删除</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="l2tpManager.addUser()">添加用户</button>
                        <small class="form-help">为L2TP服务器配置用户账户</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="l2tpManager.closeModal('serverModal')">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 日志查看模态框 -->
    <div id="logsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>服务器日志</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <pre id="logsContent" class="logs-content">加载中...</pre>
            </div>
        </div>
    </div>

    <!-- 导出配置模态框 -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>导出服务器配置</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="exportForm">
                    <div class="form-group">
                        <label>导出范围</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="exportRange" value="all" checked>
                                <span>所有服务器</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="exportRange" value="filtered">
                                <span>按条件筛选</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>导出格式</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="exportFormat" value="simple" checked>
                                <span>简化配置</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="exportFormat" value="detailed">
                                <span>详细配置</span>
                            </label>
                        </div>
                    </div>

                    <div id="filterOptions" class="filter-options" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dateFrom">创建日期从</label>
                                <input type="date" id="dateFrom" name="dateFrom">
                            </div>
                            <div class="form-group">
                                <label for="dateTo">创建日期到</label>
                                <input type="date" id="dateTo" name="dateTo">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expireFrom">到期日期从</label>
                                <input type="date" id="expireFrom" name="expireFrom">
                            </div>
                            <div class="form-group">
                                <label for="expireTo">到期日期到</label>
                                <input type="date" id="expireTo" name="expireTo">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="portFrom">端口范围从</label>
                                <input type="number" id="portFrom" name="portFrom" min="1" max="65535" placeholder="1">
                            </div>
                            <div class="form-group">
                                <label for="portTo">端口范围到</label>
                                <input type="number" id="portTo" name="portTo" min="1" max="65535" placeholder="65535">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="statusFilter">服务器状态</label>
                                <select id="statusFilter" name="statusFilter">
                                    <option value="">所有状态</option>
                                    <option value="running">运行中</option>
                                    <option value="stopped">已停止</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nameFilter">服务器名称包含</label>
                                <input type="text" id="nameFilter" name="nameFilter" placeholder="输入名称关键词">
                            </div>
                        </div>
                    </div>



                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="l2tpManager.closeModal('exportModal')">取消</button>
                        <button type="button" class="btn btn-info" onclick="l2tpManager.previewExport()">预览</button>
                        <button type="submit" class="btn btn-primary">导出</button>
                    </div>
                </form>
                
                <!-- 预览区域 -->
                <div id="exportPreview" class="export-preview" style="display: none;">
                    <h4>导出预览</h4>
                    <div class="preview-info">
                        <span id="previewCount">0</span> 个服务器将被导出
                    </div>
                    <pre id="previewContent" class="preview-content"></pre>
                    <div class="preview-actions">
                        <button type="button" class="btn btn-secondary" onclick="l2tpManager.hidePreview()">关闭预览</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html> 